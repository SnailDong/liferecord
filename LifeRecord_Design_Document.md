# LifeRecord Flutteråº”ç”¨è®¾è®¡æ–‡æ¡£

## 1. åº”ç”¨æ¦‚è¿°

**åº”ç”¨åç§°**: LifeRecord  
**å¹³å°**: Flutter (iOS/Android)  
**ç›®æ ‡**: æä¾›ä¸€ä¸ªç®€æ´æ˜“ç”¨çš„ç”Ÿæ´»è®°å½•å·¥å…·ï¼Œä¸“æ³¨äºè®°å½•å’Œç®¡ç†æ—¥å¸¸ç”Ÿæ´»ä¸­çš„æ”¶æ”¯æƒ…å†µ  
**å½“å‰é˜¶æ®µ**: å®ç°åŸºç¡€æ”¶æ”¯è®°å½•åŠŸèƒ½

## 2. æ•´ä½“æ¶æ„è®¾è®¡

### 2.1 æŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: Flutter 3.x
- **çŠ¶æ€ç®¡ç†**: Provider + Riverpod (æœªæ¥æ‰©å±•è€ƒè™‘)
- **æœ¬åœ°æ•°æ®åº“**: SQLite (é€šè¿‡sqfliteåŒ…)
- **UIç»„ä»¶**: Material Design 3
- **å›½é™…åŒ–**: flutter_localizations (é¢„ç•™)

### 2.2 é¡¹ç›®ç»“æ„

LifeRecord é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œéµå¾ªæ¸…æ™°çš„èŒè´£åˆ†ç¦»åŸåˆ™ã€‚é¡¹ç›®ç»“æ„åˆ†ä¸ºåº”ç”¨å±‚ã€æ ¸å¿ƒå±‚ã€æ¨¡å—å±‚å’Œå…±äº«å±‚ï¼Œç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

```
life_record/                     # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ android/                     # Androidå¹³å°ç‰¹å®šä»£ç 
â”œâ”€â”€ ios/                         # iOSå¹³å°ç‰¹å®šä»£ç 
â”œâ”€â”€ lib/                         # Flutteræºç ç›®å½•
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹å±‚ï¼ˆæŒ‰æ¨¡å—ç»„ç»‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ finance/             # è´¢åŠ¡æ¨¡å—æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ transaction.dart # äº¤æ˜“è®°å½•æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ category.dart    # åˆ†ç±»æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ filter_criteria.dart # ç­›é€‰æ¡ä»¶æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ diary/               # æ—¥è®°æ¨¡å—æ•°æ®æ¨¡å‹ï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â”œâ”€â”€ habit/               # ä¹ æƒ¯æ¨¡å—æ•°æ®æ¨¡å‹ï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â”œâ”€â”€ health/              # å¥åº·æ¨¡å—æ•°æ®æ¨¡å‹ï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â”œâ”€â”€ travel/              # æ—…è¡Œæ¨¡å—æ•°æ®æ¨¡å‹ï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â””â”€â”€ common/              # é€šç”¨æ•°æ®æ¨¡å‹
â”‚   â”‚       â”œâ”€â”€ base_model.dart  # åŸºç¡€æ¨¡å‹ç±»
â”‚   â”‚       â””â”€â”€ api_response.dart # APIå“åº”æ¨¡å‹
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåŠŸèƒ½å±‚ï¼ˆåº”ç”¨çº§ï¼‰
â”‚   â”‚   â”œâ”€â”€ app/                 # åº”ç”¨æ ¸å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ app.dart         # åº”ç”¨å…¥å£ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ routes.dart      # è·¯ç”±é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ lifecycle.dart   # åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database/            # æ•°æ®åº“å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ models/          # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ services/        # æ•°æ®åº“æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ migrations/      # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”œâ”€â”€ navigation/          # å¯¼èˆªç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ router.dart      # è·¯ç”±ç®¡ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ guards/          # è·¯ç”±å®ˆå«
â”‚   â”‚   â”œâ”€â”€ theme/               # ä¸»é¢˜é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ colors.dart      # é¢œè‰²å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ themes.dart      # ä¸»é¢˜é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ typography.dart  # å­—ä½“æ ·å¼
â”‚   â”‚   â””â”€â”€ utils/               # æ ¸å¿ƒå·¥å…·ç±»
â”‚   â”‚       â”œâ”€â”€ constants.dart   # åº”ç”¨å¸¸é‡
â”‚   â”‚       â”œâ”€â”€ extensions/      # Dartæ‰©å±•
â”‚   â”‚       â”œâ”€â”€ formatters/      # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚       â”œâ”€â”€ validators/      # éªŒè¯å·¥å…·
â”‚   â”‚       â””â”€â”€ converters/      # è½¬æ¢å·¥å…·
â”‚   â””â”€â”€ modules/              # åŠŸèƒ½æ¨¡å—å±‚
â”‚       â”œâ”€â”€ finance/             # è´¢åŠ¡æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ finance_home/          # è´¢åŠ¡ä¸»é¡µ
â”‚       â”‚   â”‚   â”œâ”€â”€ view.dart          # ä¸»é¡µé¢UI
â”‚       â”‚   â”‚   â”œâ”€â”€ logic.dart         # é¡µé¢é€»è¾‘
â”‚       â”‚   â”‚   â”œâ”€â”€ state.dart         # é¡µé¢çŠ¶æ€
â”‚       â”‚   â”‚   â””â”€â”€ widgets.dart       # é¡µé¢ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ transaction_list/      # äº¤æ˜“è®°å½•åˆ—è¡¨é¡µ
â”‚       â”‚   â”‚   â”œâ”€â”€ view.dart          # åˆ—è¡¨é¡µé¢UI
â”‚       â”‚   â”‚   â”œâ”€â”€ logic.dart         # åˆ—è¡¨é¡µé¢é€»è¾‘
â”‚       â”‚   â”‚   â”œâ”€â”€ state.dart         # åˆ—è¡¨é¡µé¢çŠ¶æ€
â”‚       â”‚   â”‚   â””â”€â”€ widgets.dart       # åˆ—è¡¨é¡µé¢ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ transaction_form/      # äº¤æ˜“è®°å½•è¡¨å•é¡µ
â”‚       â”‚   â”‚   â”œâ”€â”€ view.dart          # è¡¨å•é¡µé¢UI
â”‚       â”‚   â”‚   â”œâ”€â”€ logic.dart         # è¡¨å•é¡µé¢é€»è¾‘
â”‚       â”‚   â”‚   â”œâ”€â”€ state.dart         # è¡¨å•é¡µé¢çŠ¶æ€
â”‚       â”‚   â”‚   â””â”€â”€ widgets.dart       # è¡¨å•é¡µé¢ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ statistics/            # ç»Ÿè®¡é¡µé¢
â”‚       â”‚   â”‚   â”œâ”€â”€ view.dart          # ç»Ÿè®¡é¡µé¢UI
â”‚       â”‚   â”‚   â”œâ”€â”€ logic.dart         # ç»Ÿè®¡é¡µé¢é€»è¾‘
â”‚       â”‚   â”‚   â”œâ”€â”€ state.dart         # ç»Ÿè®¡é¡µé¢çŠ¶æ€
â”‚       â”‚   â”‚   â””â”€â”€ widgets.dart       # ç»Ÿè®¡é¡µé¢ç»„ä»¶
â”‚       â”‚   â””â”€â”€ filter/                # ç­›é€‰é¡µé¢
â”‚       â”‚           â”œâ”€â”€ view.dart          # ç­›é€‰é¡µé¢UI
â”‚       â”‚           â”œâ”€â”€ logic.dart         # ç­›é€‰é¡µé¢é€»è¾‘
â”‚       â”‚           â”œâ”€â”€ state.dart         # ç­›é€‰é¡µé¢çŠ¶æ€
â”‚       â”‚           â””â”€â”€ widgets.dart       # ç­›é€‰é¡µé¢ç»„ä»¶
â”‚       â”œâ”€â”€ diary/               # æ—¥è®°æ¨¡å—ï¼ˆé¢„ç•™ï¼‰
â”‚       â”œâ”€â”€ habit/               # ä¹ æƒ¯è¿½è¸ªæ¨¡å—ï¼ˆé¢„ç•™ï¼‰
â”‚       â”œâ”€â”€ health/              # å¥åº·ç®¡ç†æ¨¡å—ï¼ˆé¢„ç•™ï¼‰
â”‚       â””â”€â”€ travel/              # æ—…è¡Œè®°å½•æ¨¡å—ï¼ˆé¢„ç•™ï¼‰
â”‚   â”œâ”€â”€ shared/                  # å…±äº«ç»„ä»¶å±‚
â”‚   â”‚   â””â”€â”€ ui/                  # å…±äº«UIç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ components/      # åŸºç¡€ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ layouts/         # å¸ƒå±€ç»„ä»¶
â”‚   â”‚       â””â”€â”€ animations/      # åŠ¨ç”»ç»„ä»¶
â”‚   â”œâ”€â”€ config/                  # åº”ç”¨é…ç½®å±‚
â”‚   â”‚   â”œâ”€â”€ app_config.dart      # åº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ module_config.dart   # æ¨¡å—é…ç½®
â”‚   â”‚   â”œâ”€â”€ navigation_config.dart # å¯¼èˆªé…ç½®
â”‚   â”‚   â””â”€â”€ feature_flags.dart   # åŠŸèƒ½å¼€å…³
â”‚   â””â”€â”€ main.dart                # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ assets/                      # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/                  # å›¾ç‰‡èµ„æº
â”‚   â”œâ”€â”€ icons/                   # å›¾æ ‡èµ„æº
â”‚   â”œâ”€â”€ fonts/                   # å­—ä½“æ–‡ä»¶
â”‚   â””â”€â”€ animations/              # åŠ¨ç”»èµ„æº
â”œâ”€â”€ l10n/                        # å›½é™…åŒ–èµ„æº
â”‚   â”œâ”€â”€ intl_en.arb              # è‹±æ–‡ç¿»è¯‘
â”‚   â”œâ”€â”€ intl_zh.arb              # ä¸­æ–‡ç¿»è¯‘
â”‚   â””â”€â”€ l10n.dart                # æœ¬åœ°åŒ–é…ç½®
â”œâ”€â”€ analysis_options.yaml        # ä»£ç åˆ†æé…ç½®
â”œâ”€â”€ pubspec.yaml                 # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ flutter_launcher_icons.yaml  # åº”ç”¨å›¾æ ‡é…ç½®
```

### 2.2.1 ç›®å½•èŒè´£è¯´æ˜

#### **æ•°æ®æ¨¡å‹å±‚ (models/)**
- **èŒè´£èŒƒå›´**: å­˜æ”¾å„æ¨¡å—çš„æ•°æ®ç»“æ„ç±»å’Œå®ä½“æ¨¡å‹
- **ç»„ç»‡æ–¹å¼**: æŒ‰æ¨¡å—åˆ’åˆ†å­ç›®å½•ï¼Œæ¯ä¸ªæ¨¡å—ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„æ•°æ®æ¨¡å‹
- **ä½¿ç”¨åŸåˆ™**: æ•°æ®æ¨¡å‹åº”åªåŒ…å«æ•°æ®å®šä¹‰ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- **åŒ…å«å†…å®¹**:
  - å„æ¨¡å—çš„å®ä½“ç±»å®šä¹‰
  - æ•°æ®ä¼ è¾“å¯¹è±¡(DTO)
  - æšä¸¾ç±»å‹å’Œå¸¸é‡
  - åºåˆ—åŒ–/ååºåˆ—åŒ–æ–¹æ³•

#### **æ ¸å¿ƒåŠŸèƒ½å±‚ (core/)**
- **èŒè´£èŒƒå›´**: æä¾›åº”ç”¨çº§çš„åŸºç¡€åŠŸèƒ½å’ŒæœåŠ¡
- **ä½¿ç”¨åŸåˆ™**: åªåŒ…å«åº”ç”¨é€šç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸åº”åŒ…å«å…·ä½“ä¸šåŠ¡é€»è¾‘
- **åŒ…å«å†…å®¹**:
  - åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - æ•°æ®åº“åŸºç¡€æœåŠ¡
  - è·¯ç”±å¯¼èˆªæ¡†æ¶
  - ä¸»é¢˜å’Œæ ·å¼é…ç½®
  - æ ¸å¿ƒå·¥å…·å‡½æ•°ï¼ˆå¸¸é‡ã€æ‰©å±•ã€æ ¼å¼åŒ–ã€éªŒè¯ã€è½¬æ¢ï¼‰

#### **åŠŸèƒ½æ¨¡å—å±‚ (modules/)**
- **èŒè´£èŒƒå›´**: å®ç°å…·ä½“çš„UIç•Œé¢å’Œé¡µé¢é€»è¾‘ï¼Œæ¯ä¸ªæ¨¡å—ç‹¬ç«‹å¼€å‘å’Œç»´æŠ¤
- **ä½¿ç”¨åŸåˆ™**: æ¨¡å—é—´ä½è€¦åˆï¼Œé€šè¿‡æ ‡å‡†æ¥å£è¿›è¡Œé€šä¿¡
- **æ¶æ„æ¨¡å¼**: æ¯ä¸ªé¡µé¢é‡‡ç”¨ View-Logic-State-Widgets å››å±‚æ¶æ„
- **é¡µé¢ç»“æ„**: æ¯ä¸ªé¡µé¢ç‹¬ç«‹ç›®å½•ï¼ŒåŒ…å«view.dartã€logic.dartã€state.dartã€widgets.dart
- **åŒ…å«å†…å®¹**:
  - [module_name]/: æ¨¡å—ç›®å½•ï¼Œæ¯ä¸ªæ¨¡å—åŒ…å«å…¶æ‰€æœ‰é¡µé¢ç›®å½•

#### **å…±äº«ç»„ä»¶å±‚ (shared/)**
- **èŒè´£èŒƒå›´**: æä¾›è·¨æ¨¡å—å…±äº«çš„UIç»„ä»¶
- **ä½¿ç”¨åŸåˆ™**: åªåŒ…å«çœŸæ­£è·¨æ¨¡å—å…±äº«çš„å†…å®¹ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘æˆ–æ•°æ®è®¿é—®
- **åŒ…å«å†…å®¹**:
  - ui/: é€šç”¨UIç»„ä»¶åº“ï¼ˆæŒ‰é’®ã€è¡¨å•ã€å¡ç‰‡ç­‰åŸºç¡€ç»„ä»¶ï¼‰

#### **åº”ç”¨é…ç½®å±‚ (config/)**
- **èŒè´£èŒƒå›´**: ç®¡ç†åº”ç”¨çš„é…ç½®ä¿¡æ¯å’Œæ¨¡å—æ³¨å†Œ
- **ä½¿ç”¨åŸåˆ™**: é…ç½®ä¸ä»£ç åˆ†ç¦»ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´
- **åŒ…å«å†…å®¹**:
  - åº”ç”¨åŸºç¡€é…ç½®
  - æ¨¡å—æ³¨å†Œé…ç½®
  - å¯¼èˆªè·¯ç”±é…ç½®
  - åŠŸèƒ½å¼€å…³æ§åˆ¶

#### **å›½é™…åŒ–ç›®å½• (l10n/)**
- **èŒè´£èŒƒå›´**: æ”¯æŒå¤šè¯­è¨€ç•Œé¢å’Œæœ¬åœ°åŒ–å†…å®¹
- **å®ç°æ–¹å¼**: ä½¿ç”¨Flutter Intlæ’ä»¶ç®¡ç†ç¿»è¯‘èµ„æº
- **æ”¯æŒè¯­è¨€**: ä¸­æ–‡ã€è‹±æ–‡ï¼Œå¯æ‰©å±•å…¶ä»–è¯­è¨€

#### **é™æ€èµ„æº (assets/)**
- **èŒè´£èŒƒå›´**: ç®¡ç†åº”ç”¨çš„å›¾ç‰‡ã€å›¾æ ‡ã€å­—ä½“ç­‰é™æ€èµ„æº
- **ç»„ç»‡æ–¹å¼**: æŒ‰ç±»å‹åˆ†ç±»å­˜æ”¾ï¼Œä¾¿äºç®¡ç†å’Œç»´æŠ¤
- **ä¼˜åŒ–ç­–ç•¥**: åˆç†å‹ç¼©å’Œç¼“å­˜ï¼Œæå‡åº”ç”¨æ€§èƒ½

### 2.3 è®¾è®¡åŸåˆ™
- **ç®€æ´æ€§**: ç•Œé¢ç®€æ´ï¼Œæ“ä½œç›´è§‚
- **æœ¬åœ°ä¼˜å…ˆ**: æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡
- **æ¨¡å—åŒ–**: åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºæ‰©å±•ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½
- **é…ç½®åŒ–**: é€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€ç®¡ç†åŠŸèƒ½æ¨¡å—
- **å“åº”å¼**: æ”¯æŒä¸åŒå±å¹•å°ºå¯¸
- **å¯æ‰©å±•æ€§**: æ¶æ„è®¾è®¡é¢„ç•™æ‰©å±•ç©ºé—´ï¼Œä¾¿äºåç»­åŠŸèƒ½æ¨¡å—æ·»åŠ 

### 2.4 æ¨¡å—é…ç½®ç³»ç»Ÿ
```dart
// æ¨¡å—é…ç½®æ¨¡å‹
class SCModuleConfig {
  final String id;              // æ¨¡å—å”¯ä¸€æ ‡è¯†
  final String name;            // æ¨¡å—åç§°
  final String icon;            // æ¨¡å—å›¾æ ‡
  final String route;           // æ¨¡å—è·¯ç”±
  final bool enabled;           // æ˜¯å¦å¯ç”¨
  final int order;              // æ˜¾ç¤ºé¡ºåº
  final ModuleType type;        // æ¨¡å—ç±»å‹
  final Map<String, dynamic> settings; // æ¨¡å—è®¾ç½®
}

// å¯¼èˆªé…ç½®
class SCNavigationConfig {
  final List<BottomNavItem> bottomNavItems;  // åº•éƒ¨å¯¼èˆªé¡¹
  final List<DrawerMenuItem> drawerItems;    // æŠ½å±‰èœå•é¡¹
  final List<ModuleCard> moduleCards;        // ä¸»é¡µæ¨¡å—å¡ç‰‡
}

// æ¨¡å—ç±»å‹æšä¸¾
enum ModuleType {
  finance,      // è´¢åŠ¡ç®¡ç†
  diary,        // æ—¥è®°
  habit,        // ä¹ æƒ¯è¿½è¸ª
  health,       // å¥åº·ç®¡ç†
  travel,       // æ—…è¡Œè®°å½•
  custom        // è‡ªå®šä¹‰æ¨¡å—
}
```

## 3. é¡µé¢æ¶æ„è®¾è®¡è§„èŒƒï¼ˆåŸºäº GetX + MVVM æ¨¡å¼ï¼‰

### 3.1 æ•´ä½“æ¶æ„æ¨¡å¼

LifeRecord åº”ç”¨é‡‡ç”¨ **View-Logic-State-Widgets** å››å±‚åˆ†ç¦»æ¶æ„ï¼Œç»“åˆ GetX çŠ¶æ€ç®¡ç†æ¡†æ¶ï¼Œå®ç°æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œé«˜æ•ˆçš„çŠ¶æ€ç®¡ç†ã€‚

#### 3.1.1 æ¶æ„å±‚æ¬¡è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    View Layer                        â”‚
â”‚  (view.dart - UIå±•ç¤ºå±‚ï¼Œè´Ÿè´£é¡µé¢å¸ƒå±€å’Œç”¨æˆ·äº¤äº’)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Logic Layer                        â”‚
â”‚  (logic.dart - ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€æ›´æ–°)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ ç®¡ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   State Layer                        â”‚
â”‚  (state.dart - çŠ¶æ€æ•°æ®å±‚ï¼Œå­˜å‚¨é¡µé¢çŠ¶æ€å’Œé…ç½®)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ ä½¿ç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Widgets Layer                       â”‚
â”‚  (widgets.dart - ç»„ä»¶å±‚ï¼Œå¯å¤ç”¨çš„UIç»„ä»¶)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 é¡µé¢ç»“æ„æ ‡å‡†

æ¯ä¸ªåŠŸèƒ½é¡µé¢ç‹¬ç«‹ç»„ç»‡åœ¨å•ç‹¬çš„ç›®å½•ä¸­ï¼Œé‡‡ç”¨å››å±‚æ¶æ„æ¨¡å¼ï¼š

```
lib/modules/finance/transaction_list/
â”œâ”€â”€ view.dart           # UIè§†å›¾å±‚ï¼ˆé¡µé¢ä¸»ç•Œé¢ï¼‰
â”œâ”€â”€ logic.dart          # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆæ§åˆ¶å™¨ï¼‰
â”œâ”€â”€ state.dart          # çŠ¶æ€æ•°æ®å±‚ï¼ˆå“åº”å¼çŠ¶æ€ï¼‰
â””â”€â”€ widgets.dart        # é¡µé¢ä¸“ç”¨ç»„ä»¶ï¼ˆå¯é€‰ï¼‰
```

**ç›®å½•ç»„ç»‡åŸåˆ™**ï¼š
- æ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ç›®å½•
- ç›®å½•åä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ç»„åˆ
- é¡µé¢ç›®å½•ä½äºå¯¹åº”æ¨¡å—çš„ `ui/views/` ä¸‹

**æ–‡ä»¶èŒè´£åˆ†å·¥**ï¼š
- `view.dart`: ä¸»é¡µé¢UIæ–‡ä»¶ï¼ŒåŒ…å«å®Œæ•´çš„é¡µé¢å¸ƒå±€å’Œç”¨æˆ·äº¤äº’ç»‘å®š
- `logic.dart`: ä¸šåŠ¡é€»è¾‘æ§åˆ¶å™¨ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’äº‹ä»¶å’Œæ•°æ®æ“ä½œ
- `state.dart`: çŠ¶æ€ç®¡ç†æ–‡ä»¶ï¼Œå®šä¹‰å“åº”å¼å˜é‡å’Œé¡µé¢çŠ¶æ€æ•°æ®
- `widgets.dart`: é¡µé¢ä¸“ç”¨ç»„ä»¶ï¼Œé¡µé¢å†…å¤ç”¨çš„UIç»„ä»¶ï¼ˆå¯é€‰ï¼‰

### 3.3 å„å±‚èŒè´£è¯¦è§£

#### 3.3.1 View Layerï¼ˆview.dartï¼‰

**èŒè´£**ï¼š
- é¡µé¢UIå¸ƒå±€å’Œæ¸²æŸ“
- ç”¨æˆ·äº¤äº’äº‹ä»¶ç»‘å®š
- è°ƒç”¨ Logic å±‚æ–¹æ³•
- ç›‘å¬ State å˜åŒ–å¹¶æ›´æ–°UI

**è®¾è®¡è§„èŒƒ**ï¼š
- ä½¿ç”¨è·¯ç”±æ³¨è§£æ ‡è®°é¡µé¢è·¯å¾„ï¼ˆ`@RouterPage`ï¼‰
- æä¾›é™æ€å¯¼èˆªæ–¹æ³•ï¼ˆ`toXxxPage`ï¼‰
- State ç»§æ‰¿ç»Ÿä¸€çš„é¡µé¢åŸºç±»ï¼ˆ`CommonPageState`ï¼‰
- ä½¿ç”¨ GetX ä¾èµ–æ³¨å…¥ï¼ˆ`Get.put`ã€`Get.find`ï¼‰
- ä½¿ç”¨ `Obx` å“åº”å¼æ›´æ–°UI
- å°†UIæ‹†åˆ†ä¸ºç‹¬ç«‹çš„Widgetæ–¹æ³•
- åœ¨ dispose ä¸­æ¸…ç†èµ„æº

**å…³é”®è¦ç‚¹**ï¼š
- ç»§æ‰¿ `CommonPageState` ç»Ÿä¸€é¡µé¢ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ä½¿ç”¨ `Obx` æˆ– `GetBuilder` å®ç°å“åº”å¼UIæ›´æ–°
- UIä»£ç åº”ç®€æ´ï¼Œå¤æ‚é€»è¾‘å§”æ‰˜ç»™ Logic å±‚
- å°†å¤§å‹Widgetæ‹†åˆ†ä¸ºç‹¬ç«‹çš„ç§æœ‰æ–¹æ³•æˆ–ç‹¬ç«‹ç»„ä»¶
- ä½¿ç”¨ `@RouterPage` æ³¨è§£å£°æ˜è·¯ç”±è·¯å¾„

#### 3.3.2 Logic Layerï¼ˆlogic.dartï¼‰

**èŒè´£**ï¼š
- å¤„ç†ä¸šåŠ¡é€»è¾‘
- è°ƒç”¨ Service å±‚è¿›è¡Œæ•°æ®æ“ä½œ
- ç®¡ç†é¡µé¢çŠ¶æ€ï¼ˆé€šè¿‡ Stateï¼‰
- å¤„ç†ç”¨æˆ·äº¤äº’äº‹ä»¶
- é¡µé¢ç”Ÿå‘½å‘¨æœŸç®¡ç†

**è®¾è®¡è§„èŒƒ**ï¼š
- ç»§æ‰¿ `GetxController` è·å¾—ç”Ÿå‘½å‘¨æœŸç®¡ç†èƒ½åŠ›
- æ‰€æœ‰ä¸šåŠ¡é€»è¾‘é›†ä¸­åœ¨ Logic å±‚
- é€šè¿‡ State å¯¹è±¡ç®¡ç†é¡µé¢çŠ¶æ€
- å¼‚æ­¥æ“ä½œä½¿ç”¨ async/await æ¨¡å¼
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- æ¸…æ™°çš„æ–¹æ³•å‘½åï¼ˆonå‰ç¼€è¡¨ç¤ºäº‹ä»¶å¤„ç†ï¼‰

**å…³é”®è¦ç‚¹**ï¼š
- åœ¨ `onReady` ä¸­å¤„ç†åˆå§‹åŒ–é€»è¾‘
- ä½¿ç”¨ä¾èµ–æ³¨å…¥è·å–æœåŠ¡å±‚å®ä¾‹
- æä¾›æ¸…æ™°çš„å…¬å…±æ–¹æ³•ä¾› View è°ƒç”¨
- å®ç°å¯¼èˆªæ§åˆ¶æ–¹æ³•
- åœ¨ `onClose` ä¸­æ¸…ç†èµ„æº

#### 3.3.3 State Layerï¼ˆstate.dartï¼‰

**èŒè´£**ï¼š
- å­˜å‚¨é¡µé¢çŠ¶æ€æ•°æ®
- å®šä¹‰å“åº”å¼å˜é‡
- å­˜å‚¨é¡µé¢é…ç½®ä¿¡æ¯
- ç®¡ç†ä¸´æ—¶æ•°æ®

**è®¾è®¡è§„èŒƒ**ï¼š
- ä½¿ç”¨ `Rx` ç±»å‹ï¼ˆRxBoolã€RxIntã€RxListç­‰ï¼‰åˆ›å»ºå“åº”å¼å˜é‡
- ä½¿ç”¨ `.obs` å°†æ™®é€šå˜é‡è½¬ä¸ºå“åº”å¼
- åŒºåˆ†å“åº”å¼æ•°æ®å’Œæ™®é€šæ•°æ®
- æä¾›è®¡ç®—å±æ€§ç®€åŒ–é€»è¾‘
- æ”¯æŒå¤šæ­¥éª¤æµç¨‹çš„é…ç½®åŒ–ç®¡ç†

**å…³é”®è¦ç‚¹**ï¼š
- å“åº”å¼æ•°æ®ç”¨äºéœ€è¦è‡ªåŠ¨æ›´æ–°UIçš„åœºæ™¯
- æ™®é€šæ•°æ®ç”¨äºä¸éœ€è¦è§¦å‘UIæ›´æ–°çš„åœºæ™¯
- ä½¿ç”¨ Map é…ç½®å¤šæ­¥éª¤æµç¨‹çš„çŠ¶æ€
- æä¾› dispose æ–¹æ³•æ¸…ç†èµ„æº

#### 3.3.4 Widgets Layerï¼ˆwidgets.dartï¼‰

**èŒè´£**ï¼š
- å°è£…é¡µé¢ä¸“ç”¨çš„å¯å¤ç”¨ç»„ä»¶
- å‡å°‘ View å±‚ä»£ç å¤æ‚åº¦
- æé«˜ç»„ä»¶å¤ç”¨æ€§

**è®¾è®¡è§„èŒƒ**ï¼š
- åˆ›å»ºç‹¬ç«‹çš„ StatelessWidget æˆ– StatefulWidget
- é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’å¿…è¦çš„æ•°æ®å’Œå›è°ƒ
- ç»„ä»¶åº”è¯¥æ˜¯çº¯UIç»„ä»¶ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- æä¾›æ¸…æ™°çš„å‚æ•°å‘½åå’Œç±»å‹

### 3.4 é¡µé¢åŸºç±»è®¾è®¡

#### 3.4.1 CommonPageState åŸºç±»

æ‰€æœ‰é¡µé¢çš„ State ç±»åº”ç»§æ‰¿ç»Ÿä¸€çš„åŸºç±»ï¼Œæä¾›é€šç”¨åŠŸèƒ½ï¼š

**åŸºç±»æä¾›çš„èƒ½åŠ›**ï¼š
- ç»Ÿä¸€çš„è¿”å›æŒ‰é’®å¤„ç†
- é¡µé¢å¯è§æ€§ç›‘å¬
- åº”ç”¨å‰åå°åˆ‡æ¢ç›‘å¬
- åŸ‹ç‚¹ä¸ŠæŠ¥æ”¯æŒ
- ç”Ÿå‘½å‘¨æœŸç®¡ç†

**å­ç±»éœ€è¦å®ç°**ï¼š
- `pageName`ï¼šé¡µé¢æ ‡è¯†ï¼ˆå¿…é¡»ï¼‰
- `onBackPressed()`ï¼šè‡ªå®šä¹‰è¿”å›é€»è¾‘ï¼ˆå¯é€‰ï¼‰
- `onPageShow()`ï¼šé¡µé¢æ˜¾ç¤ºå›è°ƒï¼ˆå¯é€‰ï¼‰
- `onPageHide()`ï¼šé¡µé¢éšè—å›è°ƒï¼ˆå¯é€‰ï¼‰

### 3.5 å…¨å±€æ§åˆ¶å™¨è®¾è®¡

#### 3.5.1 FinanceControllerï¼ˆè´¢åŠ¡æ¨¡å—å…¨å±€æ§åˆ¶å™¨ï¼‰

é‡‡ç”¨å•ä¾‹æ¨¡å¼è®¾è®¡ï¼Œæä¾›ï¼š
- ç®¡ç†è·¨é¡µé¢çš„å…¨å±€çŠ¶æ€
- ç»Ÿä¸€çš„é¡µé¢å¯¼èˆªå…¥å£
- ä¸šåŠ¡æµç¨‹åè°ƒ
- æ¨¡å—é—´é€šä¿¡æ¡¥æ¢

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `setCurrentTransaction()`ï¼šè®¾ç½®å½“å‰äº¤æ˜“è®°å½•
- `setCurrentFilter()`ï¼šè®¾ç½®å½“å‰ç­›é€‰æ¡ä»¶
- `navigateToXxx()`ï¼šç»Ÿä¸€çš„å¯¼èˆªæ–¹æ³•
- `onXxxSaved()`ï¼šä¸šåŠ¡æµç¨‹å›è°ƒ

### 3.6 è·¯ç”±å¯¼èˆªè®¾è®¡

#### 3.6.1 è·¯ç”±æ³¨è§£

ä½¿ç”¨ `@RouterPage` æ³¨è§£å£°æ˜é¡µé¢è·¯ç”±ï¼š
- æ¯ä¸ªé¡µé¢éƒ½æœ‰å”¯ä¸€çš„è·¯ç”±è·¯å¾„
- è·¯å¾„å‘½åè§„èŒƒï¼š`æ¨¡å—å_é¡µé¢å`ï¼ˆå¦‚ `finance_transaction_list`ï¼‰

#### 3.6.2 å¯¼èˆªæ–¹æ³•

æ¯ä¸ªé¡µé¢æä¾›é™æ€å¯¼èˆªæ–¹æ³•ï¼š
- æ–¹æ³•å‘½åï¼š`toXxxPage`
- æ”¯æŒä¼ é€’ arguments å‚æ•°
- ä½¿ç”¨ `BoostNavigator.instance.push` è¿›è¡Œå¯¼èˆª

#### 3.6.3 å¯¼èˆªå‚æ•°ä¼ é€’

**ä¼ é€’å‚æ•°çš„ä¸¤ç§æ–¹å¼**ï¼š
1. é€šè¿‡ arguments ä¼ é€’ï¼ˆé€‚åˆç®€å•æ•°æ®ï¼‰
2. é€šè¿‡å…¨å±€æ§åˆ¶å™¨ä¼ é€’ï¼ˆé€‚åˆå¤æ‚å¯¹è±¡ï¼‰

**æ¥æ”¶å‚æ•°çš„ä¸¤ç§æ–¹å¼**ï¼š
1. åœ¨ Logic çš„ `onReady` ä¸­ä» `Get.arguments` è·å–
2. ä»å…¨å±€æ§åˆ¶å™¨è·å–

### 3.7 çŠ¶æ€ç®¡ç†æ¨¡å¼

#### 3.7.1 å“åº”å¼æ›´æ–°

ä½¿ç”¨ `Obx` å®ç°å±€éƒ¨å“åº”å¼æ›´æ–°ï¼š
- åªåœ¨éœ€è¦æ›´æ–°çš„Widgetå¤–åŒ…è£¹ `Obx`
- é¿å…åœ¨å¤§èŒƒå›´Widgetä¸Šä½¿ç”¨ `Obx`
- å¤šä¸ªç‹¬ç«‹çš„å“åº”å¼åŒºåŸŸä½¿ç”¨å¤šä¸ª `Obx`

#### 3.7.2 çŠ¶æ€æ›´æ–°

åœ¨ Logic å±‚æ›´æ–°çŠ¶æ€ï¼š
- ç›´æ¥ä¿®æ”¹ `.value` å±æ€§
- ä½¿ç”¨ `assignAll` æ‰¹é‡æ›´æ–°åˆ—è¡¨
- ä½¿ç”¨ `add`ã€`remove` ç­‰æ–¹æ³•æ“ä½œé›†åˆ

### 3.8 é¡µé¢é—´é€šä¿¡

#### 3.8.1 é€šè¿‡å…¨å±€æ§åˆ¶å™¨

é€‚ç”¨äºè·¨é¡µé¢å…±äº«çŠ¶æ€

#### 3.8.2 é€šè¿‡è·¯ç”±å‚æ•°

é€‚ç”¨äºé¡µé¢é—´ä¼ é€’ç®€å•æ•°æ®å’Œæ¥æ”¶è¿”å›å€¼

#### 3.8.3 é€šè¿‡ EventBusï¼ˆå¯é€‰ï¼‰

é€‚ç”¨äºæ¨¡å—é—´æ¾è€¦åˆé€šä¿¡

### 3.9 é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€

#### 3.9.1 ç»Ÿä¸€çš„åŠ è½½çŠ¶æ€ç®¡ç†

åœ¨ State ä¸­å®šä¹‰ï¼š
- `isLoading`ï¼šåˆå§‹åŠ è½½çŠ¶æ€
- `isRefreshing`ï¼šåˆ·æ–°çŠ¶æ€
- `errorMessage`ï¼šé”™è¯¯ä¿¡æ¯

åœ¨ Logic ä¸­å¤„ç†ï¼š
- try-catch æ•è·å¼‚å¸¸
- finally å—ä¸­é‡ç½®åŠ è½½çŠ¶æ€
- ä½¿ç”¨ SmartDialog æ˜¾ç¤ºé”™è¯¯æç¤º

åœ¨ View ä¸­å±•ç¤ºï¼š
- æ ¹æ® `isLoading` æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- æ ¹æ® `errorMessage` æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
- æä¾›é‡è¯•æŒ‰é’®

### 3.10 æœ€ä½³å®è·µæ€»ç»“

#### 3.10.1 å‘½åè§„èŒƒ

- **æ–‡ä»¶å‘½å**ï¼šå°å†™ä¸‹åˆ’çº¿ï¼ˆtransaction_list_page.dartï¼‰
- **ç±»å‘½å**ï¼šå¤§é©¼å³°ï¼ˆTransactionListPageï¼‰
- **æ–¹æ³•å‘½å**ï¼šå°é©¼å³°ï¼ˆloadTransactionsï¼‰
- **äº‹ä»¶å¤„ç†æ–¹æ³•**ï¼šonå‰ç¼€ï¼ˆonDeleteTransactionï¼‰
- **ç§æœ‰æ–¹æ³•**ï¼šä¸‹åˆ’çº¿å‰ç¼€ï¼ˆ_handleErrorï¼‰
- **å¯¼èˆªæ–¹æ³•**ï¼štoå‰ç¼€ï¼ˆtoTransactionListPageï¼‰

#### 3.10.2 ä»£ç ç»„ç»‡

**View å±‚é¡ºåº**ï¼š
1. ç±»å®šä¹‰å’Œæ„é€ å‡½æ•°
2. é™æ€å¯¼èˆªæ–¹æ³•
3. State ç±»å®šä¹‰
4. Logic å’Œ State å®ä¾‹
5. ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆinitStateã€disposeç­‰ï¼‰
6. build æ–¹æ³•
7. Widget æ„å»ºæ–¹æ³•ï¼ˆæŒ‰UIå±‚æ¬¡ç»„ç»‡ï¼‰
8. äº‹ä»¶å¤„ç†æ–¹æ³•

**Logic å±‚é¡ºåº**ï¼š
1. State å®ä¾‹
2. ä¾èµ–æ³¨å…¥
3. ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆonReadyã€onCloseï¼‰
4. å…¬å…±ä¸šåŠ¡æ–¹æ³•
5. äº‹ä»¶å¤„ç†æ–¹æ³•
6. å¯¼èˆªæ–¹æ³•
7. ç§æœ‰è¾…åŠ©æ–¹æ³•

**State å±‚é¡ºåº**ï¼š
1. å“åº”å¼å˜é‡
2. æ™®é€šçŠ¶æ€å˜é‡
3. é…ç½®æ•°æ®
4. è®¡ç®—å±æ€§
5. æ–¹æ³•

#### 3.10.3 æ€§èƒ½ä¼˜åŒ–

1. **ç²¾ç¡®çš„å“åº”å¼èŒƒå›´**ï¼š
   - åªåœ¨éœ€è¦æ›´æ–°çš„Widgetå¤–åŒ…è£¹ `Obx`
   - é¿å…åœ¨å¤§èŒƒå›´Widgetä¸Šä½¿ç”¨ `Obx`

2. **åˆ—è¡¨ä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ `ListView.builder` è€Œé `ListView`
   - ä¸ºåˆ—è¡¨é¡¹æä¾›å”¯ä¸€çš„ `key`

3. **èµ„æºæ¸…ç†**ï¼š
   - åœ¨ `dispose` ä¸­æ¸…ç†å®šæ—¶å™¨ã€ç›‘å¬å™¨
   - åœ¨ `onClose` ä¸­å–æ¶ˆå¼‚æ­¥æ“ä½œ

4. **æ‡’åŠ è½½**ï¼š
   - ä½¿ç”¨ `Get.lazyPut` å»¶è¿Ÿåˆå§‹åŒ– Controller
   - åˆ†é¡µåŠ è½½å¤§æ•°æ®åˆ—è¡¨

#### 3.10.4 æµ‹è¯•å‹å¥½

1. **ä¾èµ–æ³¨å…¥**ï¼š
   - é€šè¿‡ `Get.find` è·å–ä¾èµ–
   - ä¾¿äºå•å…ƒæµ‹è¯•æ—¶ mock

2. **é€»è¾‘åˆ†ç¦»**ï¼š
   - View å±‚åªè´Ÿè´£UI
   - Logic å±‚å¯ç‹¬ç«‹æµ‹è¯•

3. **çŠ¶æ€å¯æµ‹è¯•**ï¼š
   - State æ˜¯çº¯æ•°æ®ç±»
   - æ˜“äºéªŒè¯çŠ¶æ€å˜åŒ–

### 3.11 é¡µé¢æ¶æ„å›¾ç¤º

#### 3.11.1 é¡µé¢æ¶æ„æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant View as View Layer
    participant Logic as Logic Layer
    participant State as State Layer
    participant Service as Service Layer
    participant DB as Database

    User->>View: è§¦å‘æ“ä½œ
    View->>Logic: è°ƒç”¨æ–¹æ³•
    Logic->>State: æ›´æ–°çŠ¶æ€ï¼ˆloadingï¼‰
    State-->>View: è§¦å‘UIæ›´æ–°
    Logic->>Service: è°ƒç”¨ä¸šåŠ¡æœåŠ¡
    Service->>DB: æ•°æ®æ“ä½œ
    DB-->>Service: è¿”å›æ•°æ®
    Service-->>Logic: è¿”å›ç»“æœ
    Logic->>State: æ›´æ–°çŠ¶æ€ï¼ˆæ•°æ®ï¼‰
    State-->>View: è§¦å‘UIæ›´æ–°
    View-->>User: æ˜¾ç¤ºç»“æœ
```

#### 3.11.2 GetX çŠ¶æ€ç®¡ç†æµç¨‹

```mermaid
graph LR
    A[ç”¨æˆ·æ“ä½œ] --> B[Viewè°ƒç”¨Logicæ–¹æ³•]
    B --> C[Logicæ›´æ–°State]
    C --> D{æ˜¯å¦ä¸ºRxå˜é‡?}
    D -->|æ˜¯| E[è‡ªåŠ¨é€šçŸ¥Obx]
    D -->|å¦| F[æ‰‹åŠ¨è°ƒç”¨update]
    E --> G[Viewé‡å»ºWidget]
    F --> G
    G --> H[æ˜¾ç¤ºæ–°UI]
```

#### 3.11.3 é¡µé¢ç”Ÿå‘½å‘¨æœŸ

```mermaid
stateDiagram-v2
    [*] --> Created: åˆ›å»ºé¡µé¢
    Created --> Initialized: initState()
    Initialized --> Ready: onReady()
    Ready --> Active: é¡µé¢æ¿€æ´»
    Active --> Hidden: onPageHide()
    Hidden --> Active: onPageShow()
    Active --> Background: onBackground()
    Background --> Active: onForeground()
    Active --> Disposed: dispose()
    Disposed --> [*]: onClose()
```

## 4. æ”¶æ”¯è®°å½•æ¨¡å—è®¾è®¡

### 4.1 åŠŸèƒ½éœ€æ±‚
- æ·»åŠ æ”¶æ”¯è®°å½•ï¼ˆæ”¶å…¥/æ”¯å‡ºï¼‰
- æŸ¥çœ‹æ”¶æ”¯å†å²è®°å½•
- æŒ‰æ—¥æœŸç­›é€‰è®°å½•
- ç»Ÿè®¡æ”¶æ”¯æ¦‚å†µ
- ç¼–è¾‘/åˆ é™¤è®°å½•
- åˆ†ç±»ç®¡ç†ï¼ˆé¢„æ”¯å‡ºã€é¤é¥®ã€äº¤é€šç­‰ï¼‰

### 4.2 æ•°æ®æ¨¡å‹è®¾è®¡

#### 4.2.1 æ”¶æ”¯è®°å½•æ¨¡å‹ (SCTransaction)
```dart
class SCTransaction {
  final int? id;
  final double amount;           // é‡‘é¢
  final String type;             // 'income' æˆ– 'expense'
  final int categoryId;          // å°ç±»ID (å¤–é”®å…³è”categoriesè¡¨)
  final int parentCategoryId;    // å¤§ç±»ID (å¤–é”®å…³è”categoriesè¡¨)
  final String categoryName;     // å°ç±»åç§° (å†—ä½™å­—æ®µï¼Œæå‡æŸ¥è¯¢æ€§èƒ½)
  final String parentCategoryName; // å¤§ç±»åç§° (å†—ä½™å­—æ®µï¼Œæå‡æŸ¥è¯¢æ€§èƒ½)
  final String? description;     // å¤‡æ³¨è¯´æ˜ (å¯é€‰)
  final DateTime date;           // æ—¥æœŸæ—¶é—´
  final DateTime createdAt;      // åˆ›å»ºæ—¶é—´
  final DateTime? updatedAt;     // æ›´æ–°æ—¶é—´

  SCTransaction({
    this.id,
    required this.amount,
    required this.type,
    required this.categoryId,
    required this.parentCategoryId,
    required this.categoryName,
    required this.parentCategoryName,
    this.description,
    required this.date,
    required this.createdAt,
    this.updatedAt,
  });
}
```

#### 4.2.2 æ”¶æ”¯åˆ†ç±»æ¨¡å‹ (SCCategory)
```dart
class SCCategory {
  final int? id;
  final String name;             // åˆ†ç±»åç§°
  final String type;             // 'income' æˆ– 'expense'
  final String icon;             // å›¾æ ‡åç§°
  final String color;            // é¢œè‰²ä»£ç 
  final int sortOrder;           // æ’åºé¡ºåº
  final int? parentId;           // çˆ¶åˆ†ç±»IDï¼Œä¸ºnullè¡¨ç¤ºå¤§ç±»
  final bool isDefault;          // æ˜¯å¦ä¸ºç³»ç»Ÿé¢„è®¾åˆ†ç±»
  final DateTime? createdAt;     // åˆ›å»ºæ—¶é—´
  final DateTime? updatedAt;     // æ›´æ–°æ—¶é—´

  SCCategory({
    this.id,
    required this.name,
    required this.type,
    required this.icon,
    required this.color,
    required this.sortOrder,
    this.parentId,
    this.isDefault = false,
    this.createdAt,
    this.updatedAt,
  });

  // æ˜¯å¦ä¸ºå¤§ç±»ï¼ˆçˆ¶åˆ†ç±»ï¼‰
  bool get isParent => parentId == null;

  // æ˜¯å¦ä¸ºå°ç±»ï¼ˆå­åˆ†ç±»ï¼‰
  bool get isChild => parentId != null;
}
```

### 4.3 æ•°æ®åº“è®¾è®¡

#### 4.3.1 æ•°æ®åº“è¡¨ç»“æ„

**transactions è¡¨**:
- id (INTEGER PRIMARY KEY)
- amount (REAL NOT NULL)
- type (TEXT NOT NULL) -- 'income'/'expense'
- category_id (INTEGER NOT NULL) -- å°ç±»IDï¼Œå¤–é”®å…³è”categoriesè¡¨
- parent_category_id (INTEGER NOT NULL) -- å¤§ç±»IDï¼Œå¤–é”®å…³è”categoriesè¡¨
- category_name (TEXT NOT NULL) -- å°ç±»åç§° (å†—ä½™å­—æ®µ)
- parent_category_name (TEXT NOT NULL) -- å¤§ç±»åç§° (å†—ä½™å­—æ®µ)
- description (TEXT) -- å¤‡æ³¨è¯´æ˜ (å¯é€‰)
- date (TEXT NOT NULL) -- ISO 8601æ ¼å¼
- created_at (TEXT NOT NULL)
- updated_at (TEXT)

**categories è¡¨**:
- id (INTEGER PRIMARY KEY)
- name (TEXT NOT NULL)
- type (TEXT NOT NULL)
- icon (TEXT NOT NULL)
- color (TEXT NOT NULL)
- sort_order (INTEGER NOT NULL)
- parent_id (INTEGER) -- çˆ¶åˆ†ç±»IDï¼Œä¸ºNULLè¡¨ç¤ºå¤§ç±»
- is_default (INTEGER NOT NULL DEFAULT 0) -- æ˜¯å¦ä¸ºç³»ç»Ÿé¢„è®¾åˆ†ç±»
- created_at (TEXT)
- updated_at (TEXT)

#### 4.3.2 æ•°æ®åº“æœåŠ¡ç±»
```dart
class DatabaseService {
  // åˆå§‹åŒ–æ•°æ®åº“
  Future<Database> initDatabase();

  // æ”¶æ”¯è®°å½• CRUD æ“ä½œ
  Future<int> insertTransaction(SCTransaction transaction);
  Future<List<SCTransaction>> getTransactions({
    DateTime? startDate,
    DateTime? endDate,
    String? type,  // 'income', 'expense', or null for all
    List<int>? categoryIds,  // å°ç±»IDåˆ—è¡¨
    List<int>? parentCategoryIds,  // å¤§ç±»IDåˆ—è¡¨
    double? minAmount,
    double? maxAmount,
    String? searchKeyword,  // å¤‡æ³¨æœç´¢å…³é”®è¯
  });
  Future<List<SCTransaction>> getTransactionsByCategory({
    required String categoryName,
    DateTime? startDate,
    DateTime? endDate,
  });
  Future<int> updateTransaction(SCTransaction transaction);
  Future<int> deleteTransaction(int id);

  // åˆ†ç±» CRUD æ“ä½œ
  Future<int> insertCategory(SCCategory category);
  Future<List<SCCategory>> getCategories(String type);  // è·å–æ‰€æœ‰åˆ†ç±»ï¼ˆæ ‘å½¢ç»“æ„ï¼‰
  Future<List<SCCategory>> getParentCategories(String type);  // è·å–å¤§ç±»
  Future<List<SCCategory>> getChildCategories(int parentId);  // è·å–æŒ‡å®šå¤§ç±»ä¸‹çš„å°ç±»
  Future<int> updateCategory(SCCategory category);
  Future<int> deleteCategory(int id);

  // ç»Ÿè®¡æŸ¥è¯¢
  Future<double> getTotalIncome(DateTime startDate, DateTime endDate, {List<String>? categories});
  Future<double> getTotalExpense(DateTime startDate, DateTime endDate, {List<String>? categories});
  Future<Map<String, double>> getCategorySummary(String type, DateTime startDate, DateTime endDate);
  Future<Map<String, double>> getParentCategorySummary(String type, DateTime startDate, DateTime endDate);  // å¤§ç±»æ±‡æ€»
  Future<Map<String, double>> getChildCategorySummary(int parentId, DateTime startDate, DateTime endDate);  // å°ç±»æ±‡æ€»
  Future<List<Map<String, dynamic>>> getDetailedCategoryStats({
    required String type,
    DateTime? startDate,
    DateTime? endDate,
    bool includeChildren = true,  // æ˜¯å¦åŒ…å«å­åˆ†ç±»ç»Ÿè®¡
  });  // è¯¦ç»†åˆ†ç±»ç»Ÿè®¡ï¼ˆæ”¯æŒå±‚çº§ï¼‰
}
```

### 4.4 UIç•Œé¢è®¾è®¡

#### 4.4.1 ä¸»é¡µé¢ (HomeScreen) - æ¨¡å—åŒ–è®¾è®¡
- **é¡¶éƒ¨åº”ç”¨æ **:
  - åº”ç”¨æ ‡é¢˜
  - é€šçŸ¥ä¸­å¿ƒå…¥å£
  - è®¾ç½®å…¥å£
- **æ¨¡å—å¡ç‰‡åŒºåŸŸ**:
  - ç½‘æ ¼å¸ƒå±€å±•ç¤ºå·²å¯ç”¨çš„åŠŸèƒ½æ¨¡å—
  - æ¯ä¸ªæ¨¡å—æ˜¾ç¤ºå›¾æ ‡ã€åç§°ã€å¿«æ·ç»Ÿè®¡ä¿¡æ¯
  - æ”¯æŒæ‹–æ‹½è°ƒæ•´é¡ºåº
  - ç‚¹å‡»è¿›å…¥å¯¹åº”æ¨¡å—ä¸»é¡µ
- **å¿«æ·æ“ä½œåŒºåŸŸ**:
  - å¸¸ç”¨åŠŸèƒ½å¿«æ·æŒ‰é’®ï¼ˆå¦‚æ·»åŠ æ”¶æ”¯è®°å½•ï¼‰
  - æœ€è¿‘æ“ä½œå†å²
- **åº•éƒ¨å¯¼èˆªæ **:
  - åŠ¨æ€é…ç½®çš„å¯¼èˆªé¡¹ï¼ˆé¦–é¡µã€ç»Ÿè®¡ã€è®¾ç½®ç­‰ï¼‰
  - æ”¯æŒæ‰©å±•æ·»åŠ æ–°çš„å¯¼èˆªé¡¹

#### 4.4.1.1 æ¨¡å—å¡ç‰‡è®¾è®¡
æ¯ä¸ªåŠŸèƒ½æ¨¡å—åœ¨ä¸»é¡µä»¥å¡ç‰‡å½¢å¼å±•ç¤ºï¼š
- **å›¾æ ‡å’Œåç§°**: æ¨¡å—çš„è§†è§‰æ ‡è¯†
- **ç»Ÿè®¡ä¿¡æ¯**: æ¨¡å—çš„å…³é”®æ•°æ®ï¼ˆå¦‚æ”¶æ”¯æ¨¡å—æ˜¾ç¤ºæœ¬æœˆç»“ä½™ï¼‰
- **å¿«æ·å…¥å£**: å¿«é€Ÿè®¿é—®æ¨¡å—ä¸»è¦åŠŸèƒ½
- **çŠ¶æ€æŒ‡ç¤º**: æ˜¾ç¤ºæ¨¡å—æ˜¯å¦æœ‰æœªè¯»å†…å®¹æˆ–å¾…å¤„ç†äº‹é¡¹

#### 4.4.1.2 ä¸»é¡µå¸ƒå±€é…ç½®
```dart
class SCHomeLayoutConfig {
  final int crossAxisCount;      // ç½‘æ ¼åˆ—æ•°ï¼ˆå“åº”å¼è°ƒæ•´ï¼‰
  final double cardAspectRatio;  // å¡ç‰‡å®½é«˜æ¯”
  final List<String> moduleOrder; // æ¨¡å—æ˜¾ç¤ºé¡ºåº
  final bool showStatistics;     // æ˜¯å¦æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
  final bool enableDragReorder; // æ˜¯å¦å…è®¸æ‹–æ‹½æ’åº
}
```

#### 4.4.2 è®°å½•åˆ—è¡¨é¡µé¢ (TransactionListScreen)
- æŒ‰æ—¥æœŸåˆ†ç»„æ˜¾ç¤ºè®°å½•
- æ¯æ¡è®°å½•æ˜¾ç¤º: é‡‘é¢ã€å¤§ç±»â†’å°ç±»ã€å¤‡æ³¨ï¼ˆå¦‚æœæœ‰ï¼‰
- æ”¯æŒä¸‹æ‹‰åˆ·æ–°
- æ”¯æŒæ»‘åŠ¨åˆ é™¤
- ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…ï¼ˆåŒ…å«å®Œæ•´çš„å¤§ç±»ã€å°ç±»ã€å¤‡æ³¨ä¿¡æ¯ï¼‰
- **ç­›é€‰å…¥å£**: é¡µé¢é¡¶éƒ¨æ·»åŠ ç­›é€‰æŒ‰é’®ï¼Œå¯å¿«é€Ÿè¿›å…¥ç­›é€‰é¡µé¢
- **å½“å‰ç­›é€‰çŠ¶æ€**: æ˜¾ç¤ºå½“å‰æ´»è·ƒçš„ç­›é€‰æ¡ä»¶
- **ç­›é€‰ç»“æœ**: æ ¹æ®ç­›é€‰æ¡ä»¶æ˜¾ç¤ºç›¸åº”çš„è®°å½•
- **æœç´¢åŠŸèƒ½**: æ”¯æŒæŒ‰å¤‡æ³¨å†…å®¹æœç´¢è®°å½•

#### 4.4.3 æ·»åŠ /ç¼–è¾‘è®°å½•é¡µé¢ (TransactionFormScreen)
- **é‡‘é¢è¾“å…¥**: æ•°å­—é”®ç›˜è¾“å…¥ï¼Œå¿…å¡«é¡¹
- **ç±»å‹é€‰æ‹©**: æ”¶å…¥/æ”¯å‡ºåˆ‡æ¢æŒ‰é’®
- **å¤§ç±»é€‰æ‹©**: æ ¹æ®æ”¶å…¥/æ”¯å‡ºç±»å‹æ˜¾ç¤ºå¯¹åº”çš„å¤§ç±»åˆ—è¡¨
- **å°ç±»é€‰æ‹©**: æ ¹æ®é€‰æ‹©çš„å¤§ç±»åŠ¨æ€åŠ è½½å¯¹åº”çš„å°ç±»åˆ—è¡¨
- **æ—¥æœŸé€‰æ‹©å™¨**: æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ï¼Œé»˜è®¤å½“å‰æ—¶é—´
- **å¤‡æ³¨è¾“å…¥**: å¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡†ï¼Œå¯é€‰ï¼Œç”¨äºè¯¦ç»†è¯´æ˜
- **è¡¨å•éªŒè¯**:
  - é‡‘é¢å¿…é¡»å¤§äº0
  - å¿…é¡»é€‰æ‹©å¤§ç±»å’Œå°ç±»
  - å¤‡æ³¨é•¿åº¦é™åˆ¶ï¼ˆæœ€å¤š500å­—ç¬¦ï¼‰
- **ä¿å­˜/å–æ¶ˆæŒ‰é’®**: åº•éƒ¨æ“ä½œæŒ‰é’®
- **å¿«æ·æ“ä½œ**: æ”¯æŒè¿ç»­æ·»åŠ å¤šä¸ªè®°å½•

#### 4.4.4 ç»Ÿè®¡é¡µé¢ (StatisticsScreen)
- **æ—¶é—´ç­›é€‰**: æœ¬å‘¨/æœ¬æœˆ/æœ¬å¹´/è‡ªå®šä¹‰æ—¶é—´æ®µ
- **ç±»å‹ç­›é€‰**: å…¨éƒ¨/ä»…æ”¶å…¥/ä»…æ”¯å‡º
- **åˆ†ç±»ç­›é€‰**: æ”¯æŒå±‚çº§ç­›é€‰ï¼ˆå¤§ç±»â†’å°ç±»ï¼‰
- **ç»„åˆç­›é€‰**: å¯åŒæ—¶é€‰æ‹©æ—¶é—´+ç±»å‹+åˆ†ç±»è¿›è¡Œç²¾ç¡®ç­›é€‰
- **ç»Ÿè®¡æ¦‚è§ˆ**: ç­›é€‰åæ˜¾ç¤ºæ€»æ”¶å…¥ã€æ€»æ”¯å‡ºã€ç»“ä½™
- **è¶‹åŠ¿å›¾è¡¨**: æŒ‰æ—¶é—´æ®µæ˜¾ç¤ºæ”¶æ”¯è¶‹åŠ¿
- **åˆ†ç±»å æ¯”**: é¥¼å›¾æ˜¾ç¤ºå„åˆ†ç±»å æ¯”ï¼ˆæ”¯æŒå¤§ç±»/å°ç±»è§†å›¾åˆ‡æ¢ï¼‰
- **è¯¦ç»†æ•°æ®**: æŒ‰åˆ†ç±»å±‚çº§å±•ç¤ºè¯¦ç»†ç»Ÿè®¡æ•°æ®
- **ç­›é€‰å†å²**: ä¿å­˜å¸¸ç”¨ç­›é€‰æ¡ä»¶

#### 4.4.5 ç­›é€‰é¡µé¢ (FilterScreen)
- **æ—¶é—´æ®µé€‰æ‹©**:
  - å¿«æ·é€‰é¡¹: ä»Šå¤©/æ˜¨å¤©/æœ¬å‘¨/ä¸Šå‘¨/æœ¬æœˆ/ä¸Šæœˆ/æœ¬å¹´/å»å¹´
  - è‡ªå®šä¹‰: é€‰æ‹©å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸ
- **æ”¶æ”¯ç±»å‹**: æ”¶å…¥/æ”¯å‡º/å…¨éƒ¨
- **åˆ†ç±»é€‰æ‹©**: æ ‘å½¢ç»“æ„é€‰æ‹©ï¼Œæ”¯æŒå¤šé€‰
  - å¤§ç±»é€‰æ‹©ï¼ˆå¯å±•å¼€æŸ¥çœ‹å°ç±»ï¼‰
  - å°ç±»é€‰æ‹©
  - æ”¯æŒå…¨é€‰/å–æ¶ˆå…¨é€‰
- **é«˜çº§ç­›é€‰**:
  - é‡‘é¢èŒƒå›´ç­›é€‰
  - å¤‡æ³¨å…³é”®è¯æœç´¢ï¼ˆæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼‰
- **ç­›é€‰ç»“æœé¢„è§ˆ**: æ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è®°å½•æ•°é‡
- **ä¿å­˜ç­›é€‰**: ä¿å­˜å¸¸ç”¨ç­›é€‰æ¡ä»¶ä¸ºæ¨¡æ¿

#### 4.4.6 æ¨¡å—ç®¡ç†é¡µé¢ (ModuleManagerScreen)
- **å·²å¯ç”¨æ¨¡å—**: æ˜¾ç¤ºå½“å‰å¯ç”¨çš„åŠŸèƒ½æ¨¡å—
  - æ¨¡å—å›¾æ ‡å’Œåç§°
  - å¯ç”¨/ç¦ç”¨å¼€å…³
  - æ’åºè°ƒæ•´ï¼ˆæ‹–æ‹½ï¼‰
- **å¯ç”¨æ¨¡å—**: æ˜¾ç¤ºå¯ä»¥æ·»åŠ çš„åŠŸèƒ½æ¨¡å—
  - ç³»ç»Ÿé¢„è®¾æ¨¡å—åˆ—è¡¨
  - ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å—ï¼ˆé¢„ç•™ï¼‰
- **æ¨¡å—è®¾ç½®**: ä¸ºæ¯ä¸ªæ¨¡å—æä¾›ä¸ªæ€§åŒ–è®¾ç½®
  - æ˜¾ç¤ºé€‰é¡¹ï¼ˆæ˜¯å¦åœ¨ä¸»é¡µæ˜¾ç¤ºï¼‰
  - é€šçŸ¥è®¾ç½®
  - æ•°æ®åŒæ­¥è®¾ç½®
- **æ¨¡å—é¡ºåº**: è‡ªå®šä¹‰ä¸»é¡µæ¨¡å—å¡ç‰‡çš„æ˜¾ç¤ºé¡ºåº
- **æ·»åŠ è‡ªå®šä¹‰æ¨¡å—**: æ”¯æŒç”¨æˆ·åˆ›å»ºç®€å•çš„è‡ªå®šä¹‰æ¨¡å—ï¼ˆé¢„ç•™åŠŸèƒ½ï¼‰

#### 4.4.7 è®¾ç½®é¡µé¢ (SettingsScreen)
- **é€šç”¨è®¾ç½®**:
  - ä¸»é¢˜åˆ‡æ¢ï¼ˆæ˜æš—æ¨¡å¼ï¼‰
  - è¯­è¨€è®¾ç½®
  - é€šçŸ¥è®¾ç½®
- **æ¨¡å—ç®¡ç†å…¥å£**: è·³è½¬åˆ°æ¨¡å—ç®¡ç†é¡µé¢
- **æ•°æ®ç®¡ç†**:
  - æ•°æ®å¤‡ä»½å’Œæ¢å¤
  - æ•°æ®å¯¼å‡º
  - æ¸…é™¤ç¼“å­˜
- **å…³äºåº”ç”¨**: ç‰ˆæœ¬ä¿¡æ¯ã€å¸®åŠ©æ–‡æ¡£

### 4.5 çŠ¶æ€ç®¡ç†è®¾è®¡

#### 4.5.1 Provider æ¶æ„
```dart
// æ¨¡å—ç®¡ç†çŠ¶æ€ç®¡ç†
class ModuleProvider extends ChangeNotifier {
  List<SCModuleConfig> _enabledModules = [];
  List<SCModuleConfig> _availableModules = [];
  Map<String, dynamic> _moduleSettings = {};

  // æ¨¡å—ç®¡ç†æ–¹æ³•
  Future<void> loadModules() async { ... }
  Future<void> enableModule(String moduleId) async { ... }
  Future<void> disableModule(String moduleId) async { ... }
  Future<void> reorderModules(List<String> moduleOrder) async { ... }
  Future<void> updateModuleSettings(String moduleId, Map<String, dynamic> settings) async { ... }

  // è®¡ç®—å±æ€§
  List<SCModuleConfig> get enabledModules => _enabledModules;
  List<SCModuleConfig> get availableModules => _availableModules;
  bool isModuleEnabled(String moduleId) => _enabledModules.any((m) => m.id == moduleId);
}

class SCTransactionProvider extends ChangeNotifier {
  final DatabaseService _databaseService;
  List<SCTransaction> _transactions = [];
  List<SCCategory> _incomeCategories = [];
  List<SCCategory> _expenseCategories = [];

  // ç­›é€‰çŠ¶æ€
  DateTime? _filterStartDate;
  DateTime? _filterEndDate;
  String? _filterType;  // 'income', 'expense', or null
  List<int> _filterCategoryIds = [];  // å°ç±»IDåˆ—è¡¨
  List<int> _filterParentCategoryIds = [];  // å¤§ç±»IDåˆ—è¡¨
  double? _filterMinAmount;
  double? _filterMaxAmount;
  String? _filterSearchKeyword;  // å¤‡æ³¨æœç´¢å…³é”®è¯

  // ç»Ÿè®¡æ•°æ®ç¼“å­˜
  Map<String, double> _categoryStats = {};
  Map<String, double> _parentCategoryStats = {};

  // ä¸šåŠ¡æ–¹æ³•
  Future<void> loadTransactions() async { ... }
  Future<void> loadFilteredTransactions() async { ... }  // åŠ è½½ç­›é€‰åçš„äº¤æ˜“è®°å½•
  Future<void> addTransaction(SCTransaction transaction) async { ... }
  Future<void> updateTransaction(SCTransaction transaction) async { ... }
  Future<void> deleteTransaction(int id) async { ... }

  // ç­›é€‰æ–¹æ³•
  void setDateFilter(DateTime? start, DateTime? end) { ... }
  void setTypeFilter(String? type) { ... }
  void setCategoryFilter(List<String> categories) { ... }
  void setAmountFilter(double? min, double? max) { ... }
  void clearFilters() { ... }
  void saveFilterPreset(String name) { ... }  // ä¿å­˜ç­›é€‰é¢„è®¾
  void loadFilterPreset(String name) { ... }  // åŠ è½½ç­›é€‰é¢„è®¾

  // ç»Ÿè®¡æ–¹æ³•
  Future<void> loadStatistics() async { ... }  // åŠ è½½å½“å‰ç­›é€‰æ¡ä»¶ä¸‹çš„ç»Ÿè®¡æ•°æ®
  Future<Map<String, double>> getCategoryBreakdown() async { ... }  // è·å–åˆ†ç±»æ˜ç»†
  Future<Map<String, double>> getParentCategoryBreakdown() async { ... }  // è·å–å¤§ç±»æ˜ç»†

  // è®¡ç®—å±æ€§
  double get totalIncome => ...;
  double get totalExpense => ...;
  double get balance => ...;
  bool get hasActiveFilters => ...;  // æ˜¯å¦æœ‰æ´»è·ƒçš„ç­›é€‰æ¡ä»¶
}
```

### 4.6 æ ¸å¿ƒåŠŸèƒ½å®ç°

#### 4.6.1 é¢„è®¾åˆ†ç±»

ç³»ç»Ÿé¢„è®¾å±‚çº§åˆ†ç±»ç»“æ„ï¼Œæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æ·»åŠ å’Œç¼–è¾‘å¤§ç±»åŠå°ç±»ã€‚

**æ”¶å…¥åˆ†ç±»ï¼ˆå¤§ç±»åŠå°ç±»ï¼‰**:

**ğŸ’¼ è–ªèµ„æ”¶å…¥**
- åŸºæœ¬å·¥èµ„
- åŠ ç­è´¹
- ç»©æ•ˆå¥–é‡‘
- å¹´ç»ˆå¥–
- è¡¥è´´æ´¥è´´

**ğŸ“ˆ æŠ•èµ„ç†è´¢**
- è‚¡ç¥¨æ”¶ç›Š
- åŸºé‡‘æ”¶ç›Š
- å€ºåˆ¸åˆ©æ¯
- æˆ¿ç§Ÿæ”¶å…¥
- å…¶ä»–æŠ•èµ„

**ğŸ å…¶ä»–æ”¶å…¥**
- ç¤¼é‡‘çº¢åŒ…
- å…¼èŒæ”¶å…¥
- é€€æ¬¾è¿”ç°
- å¥–é‡‘å¥–åŠ±
- å…¶ä»–æ‚é¡¹

**æ”¯å‡ºåˆ†ç±»ï¼ˆå¤§ç±»åŠå°ç±»ï¼‰**:

**ğŸ½ï¸ é¤é¥®ç¾é£Ÿ**
- æ—©é¤
- åˆé¤
- æ™šé¤
- é›¶é£Ÿé¥®æ–™
- å¤–å–è®¢é¤
- èšé¤è¯·å®¢

**ğŸš— äº¤é€šå‡ºè¡Œ**
- å…¬äº¤åœ°é“
- å‡ºç§Ÿæ‰“è½¦
- ç«è½¦é«˜é“
- é£æœº
- åŠ æ²¹è´¹
- åœè½¦è´¹
- è¿ç« ç½šæ¬¾

**ğŸ’¡ æ°´ç”µç‡ƒæ°”**
- æ°´è´¹
- ç”µè´¹
- ç‡ƒæ°”è´¹
- ç‰©ä¸šè´¹
- æš–æ°”è´¹

**ğŸ  ä½æˆ¿å±…ä½**
- æˆ¿ç§Ÿ
- æˆ¿è´·
- è£…ä¿®ç»´ä¿®
- å®¶å…·ç”µå™¨
- å®¶æ”¿æ¸…æ´

**ğŸ›ï¸ è´­ç‰©æ¶ˆè´¹**
- æœé¥°é‹å¸½
- æ—¥ç”¨å“
- ç”µå­äº§å“
- åŒ–å¦†æŠ¤è‚¤
- å¥¢ä¾ˆå“

**ğŸ¬ å¨±ä¹ä¼‘é—²**
- ç”µå½±ç¥¨
- æ¸¸æˆå……å€¼
- ä¹¦ç±æ‚å¿—
- æ¼”å”±ä¼š
- å¥èº«è¿åŠ¨
- æ—…æ¸¸åº¦å‡

**ğŸ¥ åŒ»ç–—å¥åº·**
- æŒ‚å·è´¹
- è¯å“è´¹
- ä½“æ£€è´¹
- æ²»ç–—è´¹
- ä¿é™©è´¹

**ğŸ“š æ•™è‚²åŸ¹è®­**
- å­¦è´¹
- åŸ¹è®­è´¹
- ä¹¦ç±æ•™æ
- è€ƒè¯•æŠ¥å
- çº¿ä¸Šè¯¾ç¨‹

**ğŸ“± é€šè®¯ç½‘ç»œ**
- æ‰‹æœºè¯è´¹
- å®½å¸¦ä¸Šç½‘
- æµé‡å……å€¼
- å¢å€¼æœåŠ¡

**ğŸ”§ å…¶ä»–æ”¯å‡º**
- äººæƒ…å¾€æ¥
- æèµ å…¬ç›Š
- æ„å¤–æŸå¤±
- å…¶ä»–æ‚é¡¹

#### 4.6.1.1 åˆ†ç±»ç®¡ç†åŠŸèƒ½
- **æŸ¥çœ‹åˆ†ç±»**: æ”¯æŒæ ‘å½¢ç»“æ„æ˜¾ç¤ºå¤§ç±»å’Œå°ç±»
- **æ·»åŠ å¤§ç±»**: ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æ·»åŠ æ”¶å…¥æˆ–æ”¯å‡ºå¤§ç±»
- **æ·»åŠ å°ç±»**: åœ¨æŒ‡å®šå¤§ç±»ä¸‹æ·»åŠ å°ç±»
- **ç¼–è¾‘åˆ†ç±»**: ä¿®æ”¹åˆ†ç±»åç§°ã€å›¾æ ‡ã€é¢œè‰²
- **åˆ é™¤åˆ†ç±»**: åˆ é™¤ç”¨æˆ·è‡ªå®šä¹‰çš„åˆ†ç±»ï¼ˆç³»ç»Ÿé¢„è®¾åˆ†ç±»ä¸å¯åˆ é™¤ï¼‰
- **æ’åºè°ƒæ•´**: æ‹–æ‹½è°ƒæ•´åˆ†ç±»æ˜¾ç¤ºé¡ºåº

#### 4.6.1.2 é«˜çº§ç­›é€‰åŠŸèƒ½
- **æ—¶é—´ç­›é€‰**:
  - å¿«æ·æ—¶é—´æ®µ: ä»Šå¤©ã€æ˜¨å¤©ã€æœ¬å‘¨ã€ä¸Šå‘¨ã€æœ¬æœˆã€ä¸Šæœˆã€æœ¬å­£åº¦ã€ä¸Šå­£åº¦ã€æœ¬å¹´ã€å»å¹´
  - è‡ªå®šä¹‰æ—¶é—´æ®µ: é€‰æ‹©å…·ä½“å¼€å§‹å’Œç»“æŸæ—¥æœŸ
  - æŒ‰æœˆä»½ç­›é€‰: å¿«é€Ÿé€‰æ‹©ç‰¹å®šæœˆä»½
- **ç±»å‹ç­›é€‰**:
  - å…¨éƒ¨è®°å½•
  - ä»…æ”¶å…¥è®°å½•
  - ä»…æ”¯å‡ºè®°å½•
- **åˆ†ç±»ç­›é€‰**:
  - å¤§ç±»ç­›é€‰: é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªå¤§ç±»ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
  - å°ç±»ç­›é€‰: åœ¨é€‰å®šå¤§ç±»åŸºç¡€ä¸Šé€‰æ‹©å…·ä½“å°ç±»ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
  - æ™ºèƒ½è”åŠ¨: é€‰æ‹©å¤§ç±»åè‡ªåŠ¨å±•å¼€å¯¹åº”å°ç±»ï¼Œé€‰æ‹©å°ç±»åè‡ªåŠ¨é€‰ä¸­å¯¹åº”å¤§ç±»
  - å¿«é€Ÿé€‰æ‹©: æ”¯æŒ"å…¨é€‰å¤§ç±»"ã€"å…¨é€‰å°ç±»"ç­‰å¿«æ·æ“ä½œ
- **é‡‘é¢ç­›é€‰**:
  - æœ€å°é‡‘é¢é™åˆ¶
  - æœ€å¤§é‡‘é¢é™åˆ¶
  - é‡‘é¢èŒƒå›´ç­›é€‰
- **ç»„åˆç­›é€‰ç¤ºä¾‹**:
  - "æ”¶å…¥ + è–ªèµ„æ”¶å…¥ + åŸºæœ¬å·¥èµ„ + 1æœˆä»½": æŸ¥çœ‹1æœˆä»½åŸºæœ¬å·¥èµ„æ”¶å…¥
  - "æ”¯å‡º + é¤é¥®ç¾é£Ÿ + æ—©é¤ + æœ¬å‘¨": æŸ¥çœ‹æœ¬å‘¨æ—©é¤æ”¯å‡º
  - "å…¨éƒ¨ + äº¤é€šå‡ºè¡Œ + å…¬äº¤åœ°é“ + 100-500å…ƒ": æŸ¥çœ‹100-500å…ƒä¹‹é—´çš„å…¬äº¤åœ°é“æ”¯å‡º
  - "å¤‡æ³¨æœç´¢ + 'ä¼šè®®è´¹' + æœ¬æœˆ": æœç´¢æœ¬æœˆåŒ…å«"ä¼šè®®è´¹"çš„è®°å½•
- **ç­›é€‰ç»“æœå±•ç¤º**:
  - ç­›é€‰æ¡ä»¶æ‘˜è¦æ˜¾ç¤º
  - ç¬¦åˆæ¡ä»¶çš„è®°å½•æ•°é‡
  - ç­›é€‰ç»“æœçš„æ€»æ”¶å…¥/æ”¯å‡ºç»Ÿè®¡
- **ç­›é€‰æ¨¡æ¿**:
  - ä¿å­˜å¸¸ç”¨ç­›é€‰æ¡ä»¶
  - å¿«é€Ÿåº”ç”¨é¢„è®¾ç­›é€‰
  - ç®¡ç†ç­›é€‰æ¨¡æ¿ï¼ˆé‡å‘½åã€åˆ é™¤ï¼‰

#### 4.6.2 æ•°æ®éªŒè¯
- **é‡‘é¢**: å¿…é¡»å¤§äº0ï¼Œæ”¯æŒå°æ•°ç‚¹å2ä½
- **ç±»å‹**: åªèƒ½æ˜¯'income'æˆ–'expense'
- **å¤§ç±»**: å¿…é¡»é€‰æ‹©æœ‰æ•ˆçš„å¤§ç±»ï¼ˆparentIdä¸ºnullçš„åˆ†ç±»ï¼‰
- **å°ç±»**: å¿…é¡»é€‰æ‹©å¯¹åº”å¤§ç±»ä¸‹çš„æœ‰æ•ˆå°ç±»
- **å¤‡æ³¨**: å¯é€‰ï¼Œæœ€å¤š500å­—ç¬¦ï¼Œæ”¯æŒå¤šè¡Œæ–‡æœ¬
- **æ—¥æœŸ**: ä¸èƒ½è¶…è¿‡å½“å‰æ—¥æœŸï¼Œæ”¯æŒé€‰æ‹©å†å²æ—¥æœŸ
- **è¡¨å•å®Œæ•´æ€§**: æ‰€æœ‰å¿…å¡«å­—æ®µå¿…é¡»å¡«å†™æ‰èƒ½ä¿å­˜

#### 4.6.3 æ—¥æœŸå¤„ç†
- é»˜è®¤æ—¥æœŸä¸ºå½“å‰æ—¥æœŸ
- æ”¯æŒé€‰æ‹©è¿‡å»æ—¥æœŸ
- æ˜¾ç¤ºæ ¼å¼: yyyy-MM-dd HH:mm
- å­˜å‚¨æ ¼å¼: ISO 8601

#### 4.6.4 ç­›é€‰åŠŸèƒ½å®ç°
- **ç­›é€‰çŠ¶æ€ç®¡ç†**:
  - ç­›é€‰æ¡ä»¶åœ¨åº”ç”¨é‡å¯åä¿æŒï¼ˆä½¿ç”¨SharedPreferencesï¼‰
  - æ”¯æŒå¤šæ¡ä»¶ç»„åˆç­›é€‰
  - ç­›é€‰ç»“æœå®æ—¶æ›´æ–°ç»Ÿè®¡æ•°æ®
- **æ€§èƒ½ä¼˜åŒ–**:
  - ç­›é€‰æŸ¥è¯¢ä½¿ç”¨æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
  - å¤§æ•°æ®é‡æ—¶ä½¿ç”¨åˆ†é¡µåŠ è½½
  - ç¼“å­˜å¸¸ç”¨ç­›é€‰ç»“æœ
- **ç”¨æˆ·ä½“éªŒ**:
  - ç­›é€‰æ¡ä»¶å¯è§†åŒ–æ˜¾ç¤º
  - ä¸€é”®æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶
  - ç­›é€‰å†å²è®°å½•å’Œå¸¸ç”¨ç­›é€‰æ¨¡æ¿
- **æ•°æ®å¯¼å‡º**:
  - æ”¯æŒå¯¼å‡ºç­›é€‰åçš„æ•°æ®
  - å¯¼å‡ºæ ¼å¼: CSV/Excel
  - åŒ…å«ç­›é€‰æ¡ä»¶è¯´æ˜

#### 4.6.5 æ¨¡å—åŒ–æ¶æ„å®ç°
- **æ¨¡å—æ³¨å†Œç³»ç»Ÿ**:
  - æ¨¡å—é…ç½®æ–‡ä»¶å®šä¹‰æ‰€æœ‰å¯ç”¨æ¨¡å—
  - è¿è¡Œæ—¶åŠ¨æ€åŠ è½½å¯ç”¨æ¨¡å—
  - æ¨¡å—ä¾èµ–ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶
- **å¯¼èˆªç³»ç»Ÿ**:
  - åŠ¨æ€è·¯ç”±æ³¨å†Œå’Œé…ç½®
  - åº•éƒ¨å¯¼èˆªæ åŠ¨æ€ç”Ÿæˆ
  - é¡µé¢æ ˆç®¡ç†å’Œè¿”å›é€»è¾‘
- **æ¨¡å—é—´é€šä¿¡**:
  - äº‹ä»¶æ€»çº¿(EventBus)å®ç°æ¨¡å—é—´æ¶ˆæ¯ä¼ é€’
  - å…±äº«æ•°æ®æœåŠ¡æä¾›è·¨æ¨¡å—æ•°æ®è®¿é—®
  - æ¨¡å—ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **é…ç½®æŒä¹…åŒ–**:
  - æ¨¡å—å¯ç”¨çŠ¶æ€æœ¬åœ°å­˜å‚¨
  - ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®æŒä¹…åŒ–
  - é…ç½®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

### 4.7 é”™è¯¯å¤„ç†
- æ•°æ®åº“æ“ä½œå¤±è´¥: æ˜¾ç¤ºå‹å¥½æç¤º
- ç½‘ç»œå¼‚å¸¸: ç¦»çº¿æ¨¡å¼å‹å¥½æç¤º
- æ•°æ®éªŒè¯å¤±è´¥: è¡¨å•éªŒè¯æç¤º
- æƒé™é—®é¢˜: å¼•å¯¼ç”¨æˆ·æˆæƒ

## 5. æ‰©å±•è§„åˆ’

### 5.1 çŸ­æœŸæ‰©å±• (v1.1)
- æœç´¢åŠŸèƒ½
- é«˜çº§ç­›é€‰åŠŸèƒ½å¢å¼ºï¼ˆä¿å­˜ç­›é€‰æ¨¡æ¿ã€æ™ºèƒ½æ¨èç­›é€‰ï¼‰
- æ•°æ®å¯¼å‡º (CSV/Excel)
- ä¸»é¢˜åˆ‡æ¢ (æ˜æš—æ¨¡å¼)
- å¤šè¯­è¨€æ”¯æŒ
- **æ¨¡å—åŒ–ç³»ç»Ÿå®Œå–„**:
  - æ¨¡å—ç®¡ç†ç•Œé¢
  - åŠ¨æ€æ¨¡å—åŠ è½½
  - æ¨¡å—ä¸ªæ€§åŒ–è®¾ç½®

### 5.2 ä¸­æœŸæ‰©å±• (v2.0)
- æ•°æ®åŒæ­¥ (äº‘ç«¯å¤‡ä»½)
- æ›´å¤šè®°å½•ç±»å‹ (æ—¥è®°ã€ä¹ æƒ¯è¿½è¸ª)
- å›¾è¡¨å¯è§†åŒ–å¢å¼ºï¼ˆæ”¯æŒç­›é€‰æ¡ä»¶ä¸‹çš„å›¾è¡¨ï¼‰
- é¢„ç®—ç®¡ç†ï¼ˆåŸºäºç­›é€‰æ¡ä»¶çš„é¢„ç®—è®¾ç½®ï¼‰
- æ™ºèƒ½ç­›é€‰å»ºè®®ï¼ˆåŸºäºå†å²è®°å½•æ¨èç­›é€‰ç»„åˆï¼‰
- **æ¨¡å—ç”Ÿæ€ç³»ç»Ÿ**:
  - æ’ä»¶å¸‚åœºï¼ˆç¬¬ä¸‰æ–¹æ¨¡å—ä¸‹è½½ï¼‰
  - è‡ªå®šä¹‰æ¨¡å—åˆ›å»ºå·¥å…·
  - æ¨¡å—é—´æ•°æ®å…±äº«
  - æ¨¡å—æ¨¡æ¿ç³»ç»Ÿ

### 5.3 é•¿æœŸæ‰©å±• (v3.0)
- æ•°æ®åˆ†æå’Œé¢„æµ‹
- æ™ºèƒ½åˆ†ç±»å»ºè®®
- ç¤¾äº¤åŠŸèƒ½
- è·¨å¹³å°åŒæ­¥
- **æ¨¡å—åŒ–å¹³å°**:
  - å¼€å‘è€…æ¨¡å—SDK
  - æ¨¡å—å•†åº—å’Œå®¡æ ¸ç³»ç»Ÿ
  - ä¼ä¸šçº§æ¨¡å—å®šåˆ¶
  - AIé©±åŠ¨çš„æ¨¡å—æ¨è

## 6. å¼€å‘è®¡åˆ’

### 6.1 ç¬¬ä¸€é˜¶æ®µ: åŸºç¡€æ¡†æ¶æ­å»º
1. åˆ›å»ºFlutteré¡¹ç›®
2. é…ç½®ä¾èµ–åŒ…
3. æ­å»ºæ¨¡å—åŒ–é¡¹ç›®ç»“æ„
4. å®ç°æ•°æ®åº“æœåŠ¡
5. å®ç°æ¨¡å—é…ç½®ç³»ç»Ÿ

### 6.2 ç¬¬äºŒé˜¶æ®µ: æ ¸å¿ƒåŠŸèƒ½å¼€å‘
1. å®ç°æ•°æ®æ¨¡å‹ï¼ˆåŒ…å«å¤§ç±»å°ç±»å…³ç³»å’Œå¤‡æ³¨å­—æ®µï¼‰
2. å¼€å‘æ”¶æ”¯è®°å½•CRUDï¼ˆæ”¯æŒå¤§ç±»å°ç±»é€‰æ‹©ï¼‰
3. å®ç°åŸºç¡€UIç•Œé¢ï¼ˆåŒ…å«åˆ†ç±»é€‰æ‹©å™¨å’Œå¤‡æ³¨è¾“å…¥ï¼‰
4. æ·»åŠ æ•°æ®éªŒè¯ï¼ˆåŒ…å«å¤§ç±»å°ç±»å¿…é€‰éªŒè¯ï¼‰
5. å®ç°åˆ†ç±»å±‚çº§ç®¡ç†åŠŸèƒ½
6. å®ç°æ¨¡å—åŒ–å¯¼èˆªç³»ç»Ÿ
7. å¼€å‘ä¸»é¡µæ¨¡å—å¡ç‰‡ç³»ç»Ÿ

### 6.3 ç¬¬ä¸‰é˜¶æ®µ: ä¼˜åŒ–å®Œå–„
1. UI/UXä¼˜åŒ–
2. é”™è¯¯å¤„ç†å®Œå–„
3. æ€§èƒ½ä¼˜åŒ–
4. å®Œå–„æ¨¡å—ç®¡ç†ç³»ç»Ÿ

## 7. æ¶æ„å›¾ç¤º

### 7.1 æ•´ä½“åº”ç”¨æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)"
        A[ä¸»é¡µ HomeScreen]
        B[æ”¶æ”¯æ¨¡å— FinanceModule]
        C[å…¶ä»–æ¨¡å— Modules]
        D[è®¾ç½®é¡µé¢ SettingsScreen]
    end

    subgraph "æ¨¡å—åŒ–ç³»ç»Ÿ (Module System)"
        E[æ¨¡å—é…ç½® SCModuleConfig]
        F[æ¨¡å—ç®¡ç†å™¨ ModuleManager]
        G[è·¯ç”±ç®¡ç† NavigationManager]
    end

    subgraph "çŠ¶æ€ç®¡ç†å±‚ (State Management)"
        H[SCTransactionProvider]
        I[ModuleProvider]
        J[å…¶ä»–Provider]
    end

    subgraph "ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic)"
        K[æ”¶æ”¯æœåŠ¡ FinanceService]
        L[æ•°æ®åº“æœåŠ¡ DatabaseService]
        M[å…¶ä»–æœåŠ¡ Services]
    end

    subgraph "æ•°æ®å­˜å‚¨å±‚ (Data Layer)"
        N[(SQLiteæ•°æ®åº“)]
        O[SharedPreferences]
        P[æœ¬åœ°æ–‡ä»¶å­˜å‚¨]
    end

    A --> E
    B --> E
    C --> E
    D --> F

    E --> G
    F --> G

    A --> H
    B --> H
    C --> I

    H --> K
    I --> L
    J --> M

    K --> N
    L --> N
    M --> O
    M --> P

    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style H fill:#e8f5e8
    style K fill:#fff3e0
    style N fill:#ffebee
```

### 7.2 æ¨¡å—ç»“æ„å›¾

```mermaid
graph TD
    subgraph "é¡¹ç›®æ ¹ç›®å½• (life_record/)"
        A[main.dart]
        B[android/]
        C[ios/]
        D[assets/]
        E[l10n/]

        subgraph "æºç ç›®å½• (lib/)"
            G[models/]
            H[core/]
            I[modules/]
            J[shared/]
            K[config/]
        end
    end

    subgraph "æ•°æ®æ¨¡å‹å±‚ (models/)"
        G1[finance/]
        G2[diary/]
        G3[habit/]
        G4[health/]
        G5[travel/]
        G6[common/]
    end

    subgraph "æ ¸å¿ƒå±‚ (core/)"
        H1[app/]
        H2[database/]
        H3[navigation/]
        H4[theme/]
        H5[utils/]
    end

    subgraph "åŠŸèƒ½æ¨¡å— (modules/)"
        I[finance/]
        J[diary/]
        K[habit/]
        L[health/]
        M[travel/]
    end

    subgraph "æ”¶æ”¯æ¨¡å— (modules/finance/)"
        Ia[finance_home/]
        Ib[transaction_list/]
        Ic[transaction_form/]
        Id[statistics/]
        Ie[filter/]
    end

    subgraph "å…±äº«å±‚ (shared/)"
        N[ui/]
    end

    A --> G
    A --> H
    A --> I
    A --> J
    A --> K

    H --> H1
    H --> H2
    H --> H3
    H --> H4
    H --> H5

    I --> Ia
    I --> Ib
    I --> Ic
    I --> Id
    I --> Ie

    style A fill:#e3f2fd
    style G fill:#e1f5fe
    style H fill:#f3e5f5
    style I fill:#e8f5e8
    style J fill:#fff3e0
    style K fill:#fce4ec
```

### 7.3 æ•°æ®æµå›¾

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant UI as UIç•Œé¢
    participant P as Provider
    participant S as Service
    participant DB as æ•°æ®åº“

    U->>UI: æ“ä½œç•Œé¢
    UI->>P: æ›´æ–°çŠ¶æ€
    P->>S: è°ƒç”¨ä¸šåŠ¡é€»è¾‘
    S->>DB: æ•°æ®æ“ä½œ
    DB-->>S: è¿”å›ç»“æœ
    S-->>P: å¤„ç†ç»“æœ
    P-->>UI: æ›´æ–°ç•Œé¢
    UI-->>U: æ˜¾ç¤ºç»“æœ

    Note over UI,P: çŠ¶æ€ç®¡ç†å±‚
    Note over S: ä¸šåŠ¡é€»è¾‘å±‚
    Note over DB: æ•°æ®æŒä¹…å±‚
```

### 7.4 æ”¶æ”¯è®°å½•æ¨¡å—æ¶æ„å›¾

```mermaid
graph TB
    subgraph "æ”¶æ”¯æ¨¡å—è§†å›¾ (modules/finance/views/)"
        A1[finance_home/]
        A2[transaction_list/]
        A3[transaction_form/]
        A4[statistics/]
        A5[filter/]
    end

    subgraph "é¡µé¢æ–‡ä»¶ç»“æ„"
        B1[view.dart]
        B2[logic.dart]
        B3[state.dart]
        B4[widgets.dart]
    end

    subgraph "æ•°æ®æ¨¡å‹ (models/finance/)"
        C1[SCTransaction]
        C2[SCCategory]
        C3[FilterCriteria]
    end

    subgraph "æ•°æ®åº“æœåŠ¡ (core/database/)"
        D1[FinanceService]
        D2[StatisticsService]
    end

    subgraph "æ•°æ®åº“"
        E1[(transactions)]
        E2[(categories)]
    end

    A1 --> B1
    A1 --> B2
    A1 --> B3
    A1 --> B4

    A2 --> B1
    A2 --> B2
    A2 --> B3
    A2 --> B4

    A3 --> B1
    A3 --> B2
    A3 --> B3
    A3 --> B4

    A4 --> B1
    A4 --> B2
    A4 --> B3
    A4 --> B4

    A5 --> B1
    A5 --> B2
    A5 --> B3
    A5 --> B4

    B2 --> C1
    B2 --> C2
    B2 --> C3

    B2 --> D1
    B2 --> D2

    D1 --> E1
    D2 --> E2

    style A1 fill:#e1f5fe
    style B1 fill:#f3e5f5
    style C1 fill:#e8f5e8
    style D1 fill:#fff3e0
    style E1 fill:#ffebee
```

### 7.5 æŠ€æœ¯æ ˆå±‚æ¬¡å›¾

```mermaid
graph LR
    subgraph "è¡¨ç°å±‚ (Presentation)"
        A1[Flutter Widgets]
        A2[Material Design]
        A3[è‡ªå®šä¹‰ç»„ä»¶]
    end

    subgraph "é¡µé¢é€»è¾‘ (Page Logic)"
        B1[logic.dart]
        B2[state.dart]
        B3[widgets.dart]
    end

    subgraph "ä¸šåŠ¡æœåŠ¡ (Business Services)"
        C1[Database Services]
        C2[API Services (é¢„ç•™)]
        C3[Utility Services]
    end

    subgraph "æ•°æ®æ¨¡å‹ (Data Models)"
        D1[Entity Models]
        D2[DTO Models]
        D3[Configuration Models]
    end

    subgraph "æ•°æ®å­˜å‚¨ (Data Storage)"
        E1[SQLite Database]
        E2[SharedPreferences]
        E3[File System]
    end

    A1 --> B1
    A2 --> B1
    A3 --> B1

    B1 --> C1
    B2 --> C2
    B3 --> C3

    C1 --> D1
    C2 --> D2
    C3 --> D3

    D1 --> E1
    D2 --> E2
    D3 --> E3

    style A1 fill:#e3f2fd
    style B1 fill:#f3e5f5
    style C1 fill:#e8f5e8
    style D1 fill:#fff3e0
    style E1 fill:#fce4ec
```

### 7.6 æ¨¡å—ç”Ÿå‘½å‘¨æœŸå›¾

```mermaid
stateDiagram-v2
    [*] --> æœªå®‰è£…: æ¨¡å—æœªæ·»åŠ åˆ°åº”ç”¨
    æœªå®‰è£… --> å·²ç¦ç”¨: ç”¨æˆ·é€‰æ‹©å®‰è£…ä½†æœªå¯ç”¨
    å·²ç¦ç”¨ --> æ­£åœ¨åˆå§‹åŒ–: ç”¨æˆ·å¯ç”¨æ¨¡å—
    æ­£åœ¨åˆå§‹åŒ– --> å·²æ¿€æ´»: åˆå§‹åŒ–å®Œæˆ
    å·²æ¿€æ´» --> è¿è¡Œä¸­: ç”¨æˆ·è®¿é—®æ¨¡å—
    è¿è¡Œä¸­ --> ä¼‘çœ ä¸­: é•¿æ—¶é—´æœªä½¿ç”¨
    ä¼‘çœ ä¸­ --> è¿è¡Œä¸­: ç”¨æˆ·é‡æ–°è®¿é—®
    è¿è¡Œä¸­ --> å·²ç¦ç”¨: ç”¨æˆ·æ‰‹åŠ¨ç¦ç”¨
    å·²æ¿€æ´» --> å·²ç¦ç”¨: ç”¨æˆ·æ‰‹åŠ¨ç¦ç”¨
    æ­£åœ¨åˆå§‹åŒ– --> åˆå§‹åŒ–å¤±è´¥: åˆå§‹åŒ–å‡ºé”™
    åˆå§‹åŒ–å¤±è´¥ --> å·²ç¦ç”¨: è¿”å›ç¦ç”¨çŠ¶æ€
    å·²ç¦ç”¨ --> [*]: ç”¨æˆ·å®Œå…¨å¸è½½æ¨¡å—

    note right of è¿è¡Œä¸­
        æ¨¡å—å®Œå…¨å¯ç”¨
        æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
    end note

    note right of ä¼‘çœ ä¸­
        ä¿æŒçŠ¶æ€æ•°æ®
        é‡Šæ”¾éƒ¨åˆ†èµ„æº
    end note

    note right of å·²ç¦ç”¨
        æ¨¡å—å­˜åœ¨ä½†ä¸æ˜¾ç¤º
        å¯éšæ—¶é‡æ–°å¯ç”¨
    end note
```

### 7.7 ç­›é€‰åŠŸèƒ½æµç¨‹å›¾

```mermaid
flowchart TD
    A[ç”¨æˆ·è¿›å…¥ç­›é€‰é¡µé¢] --> B{é€‰æ‹©ç­›é€‰ç±»å‹}
    B --> C[æ—¶é—´ç­›é€‰]
    B --> D[ç±»å‹ç­›é€‰]
    B --> E[åˆ†ç±»ç­›é€‰]
    B --> F[é‡‘é¢ç­›é€‰]
    B --> G[å¤‡æ³¨æœç´¢]

    C --> H[å¿«æ·æ—¶é—´æ®µ]
    C --> I[è‡ªå®šä¹‰æ—¶é—´æ®µ]

    E --> J[é€‰æ‹©å¤§ç±»]
    E --> K[è”åŠ¨åŠ è½½å°ç±»]
    E --> L[å¤šé€‰æ“ä½œ]

    H --> M[åº”ç”¨ç­›é€‰æ¡ä»¶]
    I --> M
    D --> M
    J --> M
    K --> M
    L --> M
    F --> M
    G --> M

    M --> N[é¢„è§ˆç­›é€‰ç»“æœ]
    N --> O{ç¡®è®¤ç­›é€‰}
    O --> P[åº”ç”¨ç­›é€‰å¹¶è¿”å›]
    O --> Q[è°ƒæ•´ç­›é€‰æ¡ä»¶]
    Q --> B

    P --> R[åœ¨åˆ—è¡¨é¡µé¢æ˜¾ç¤ºç­›é€‰ç»“æœ]
    R --> S[æ˜¾ç¤ºç­›é€‰ç»Ÿè®¡]
    R --> T[æ”¯æŒè¿›ä¸€æ­¥æ“ä½œ]

    style A fill:#e1f5fe
    style M fill:#f3e5f5
    style P fill:#e8f5e8
    style R fill:#fff3e0
```

## 8. æ–°åŠŸèƒ½æ¨¡å—æ·»åŠ æŒ‡å—

### 8.1 æ·»åŠ æ–°æ¨¡å—çš„æ­¥éª¤
1. **åˆ›å»ºæ•°æ®æ¨¡å‹**:
   ```
   lib/models/[module_name]/
   â”œâ”€â”€ model1.dart    # æ•°æ®æ¨¡å‹ç±»
   â”œâ”€â”€ model2.dart    # æ•°æ®æ¨¡å‹ç±»
   â””â”€â”€ types.dart     # æ¨¡å—ç›¸å…³ç±»å‹å®šä¹‰
   ```

2. **åˆ›å»ºæ¨¡å—è§†å›¾**:
   ```
   lib/modules/[module_name]/ # é¡µé¢è§†å›¾ï¼ˆæ¯ä¸ªé¡µé¢ç‹¬ç«‹ç›®å½•ï¼‰
       â”œâ”€â”€ page1/     # é¡µé¢1ç›®å½•
       â”‚   â”œâ”€â”€ view.dart    # UIè§†å›¾
       â”‚   â”œâ”€â”€ logic.dart   # ä¸šåŠ¡é€»è¾‘
       â”‚   â”œâ”€â”€ state.dart   # çŠ¶æ€ç®¡ç†
       â”‚   â””â”€â”€ widgets.dart # é¡µé¢ç»„ä»¶
       â””â”€â”€ page2/     # é¡µé¢2ç›®å½•
   ```

2. **å®šä¹‰æ¨¡å—é…ç½®**:
   ```dart
   final diaryModule = SCModuleConfig(
     id: 'diary',
     name: 'æ—¥è®°',
     icon: 'ğŸ““',
     route: '/diary',
     enabled: true,
     order: 2,
     type: ModuleType.diary,
     settings: {
       'enableReminders': true,
       'defaultPrivacy': 'private',
     },
   );
   ```

3. **å®ç°æ¨¡å—ç±»**:
   ```dart
   class DiaryModule extends AppModule {
     @override
     List<ModulePage> get pages => [DiaryHomePage(), DiaryEditorPage()];

     @override
     List<ModuleProvider> get providers => [DiaryProvider()];

     @override
     SCModuleConfig get config => diaryModule;

     @override
     Widget getHomeCard() => DiaryHomeCard();
   }
   ```

4. **æ³¨å†Œæ¨¡å—**:
   - åœ¨ `modules_config.dart` ä¸­æ·»åŠ æ¨¡å—é…ç½®
   - åœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œæ¨¡å—è·¯ç”±
   - æ›´æ–°å¯¼èˆªé…ç½®

### 8.2 æ¨¡å—é—´é€šä¿¡
- ä½¿ç”¨EventBusè¿›è¡Œæ¨¡å—é—´äº‹ä»¶ä¼ é€’
- é€šè¿‡å…±äº«æœåŠ¡è®¿é—®è·¨æ¨¡å—æ•°æ®
- å®šä¹‰æ ‡å‡†çš„æ•°æ®æ¥å£åè®®

### 8.3 æ¨¡å—ç”Ÿå‘½å‘¨æœŸ
- **åˆå§‹åŒ–**: æ¨¡å—å¯ç”¨æ—¶æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘
- **æ¿€æ´»**: ç”¨æˆ·è®¿é—®æ¨¡å—æ—¶æ¿€æ´»
- **ä¼‘çœ **: æ¨¡å—é•¿æ—¶é—´æœªä½¿ç”¨æ—¶ä¼‘çœ 
- **å¸è½½**: æ¨¡å—ç¦ç”¨æ—¶æ¸…ç†èµ„æº

è¿™æ ·çš„è®¾è®¡ç¡®ä¿äº†åº”ç”¨çš„è‰¯å¥½æ‰©å±•æ€§ï¼Œå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„åŠŸèƒ½æ¨¡å—è€Œä¸å½±å“ç°æœ‰åŠŸèƒ½ã€‚

---

